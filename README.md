# LosLog

## Introduction
This module provides some useful log classes:

- ErrorLogger  = PHP error and Exception
- EntityLogger = Doctrine ORM Entity
- SqlLogger    = Doctrine DBAL SQL
- StaticLogger = "Shortcut" to a generic file logger

## Requirements
This module only requires zendframework 2 [framework.zend.com](http://framework.zend.com/).

## Instalation
Instalation can be done with composer ou manually

### Installation with composer
For composer documentation, please refer to [getcomposer.org](http://getcomposer.org/).

  1. Enter your project directory
  2. Create or edit your `composer.json` file with following contents:

     ```json
     {
         "minimum-stability": "dev",
         "require": {
             "los/loslog": "1.*"
         }
     }
     ```
  3. Run `php composer.phar install`
  4. Open `my/project/directory/config/application.config.php` and add `LosLicense` to your `modules`
     
     Usually insert as the first module to enable catch errors and exceptions in all modules.
  
    ```php
    <?php
    return array(
        'modules' => array(
            'LosLog',
            'Application'
        ),
        'module_listener_options' => array(
            'config_glob_paths'    => array(
                'config/autoload/{,*.}{global,local}.php',
            ),
            'module_paths' => array(
                './module',
                './vendor',
            ),
        ),
    );
    ```

### Installation without composer

  1. Clone this module [LosLog](http://github.com/LansoWeb/LosLog) to your vendor directory
  2. Enable it in your config/application.config.php like the step 4 in the previous section.

## Usage
To change the options, copy the file loslog.global.php.dist to your config/autoload/ , rename it to 
loslog.global.php and change the default options.

### ErrorLogger
To enable the ErrorLogger just add the registerHandlers inside your public/index.php
 
```php
chdir(dirname(__DIR__));

require 'init_autoloader.php';

LosLog\Log\ErrorLogger::registerHandlers();

Zend\Mvc\Application::init(require 'config/application.config.php')->run();
```

You can use the logger with your phpunit tests. Just call it in your bootstrap file just after the autoload is created:
```php
LosLog\Log\ErrorLogger::registerHandlers();
```

#### Output examples

##### PHP Error
```
2012-10-30T17:58:10-02:00 ERR (3): Error: Call to a member function format() on a non-object in <filename> on line <line>
```

##### Exception
```
2012-11-01T09:23:53-02:00 ERR (3): Exception- An exception was raised while creating "Application\Service\Test"; no instance returned in <dir>/vendor/zendframework/zendframework/library/Zend/ServiceManager/ServiceManager.php in line 733.
Previous: "data/logs2/erros.log" cannot be opened with mode "a" in <dir>/vendor/zendframework/zendframework/library/Zend/Log/Writer/Stream.php in line 87.
Previous: fopen(data/logs2/erros.log): failed to open stream: No such file or directory in <dir>/vendor/zendframework/zendframework/library/Zend/Log/Writer/Stream.php in line 84.
Trace:
#0 <dir>/vendor/zendframework/zendframework/library/Zend/ServiceManager/ServiceManager.php(843): Zend\ServiceManager\ServiceManager->createServiceViaCallback(Object(Closure), 'teste', 'Application\Service\Tes...')
#1 <dir>/vendor/zendframework/zendframework/library/Zend/ServiceManager/ServiceManager.php(487): Zend\ServiceManager\ServiceManager->createFromFactory('teste', 'Application\Service\Tes...')
#2 <dir>/vendor/zendframework/zendframework/library/Zend/ServiceManager/ServiceManager.php(442): Zend\ServiceManager\ServiceManager->create(Array)
#3 <dir>/src/Application/Module.php(29): Zend\ServiceManager\ServiceManager->get('Application\Service\Tes...')
#4 [internal function]: Application\Module->onBootstrap(Object(Zend\Mvc\MvcEvent))
#5 <dir>/vendor/zendframework/zendframework/library/Zend/EventManager/EventManager.php(468): call_user_func(Array, Object(Zend\Mvc\MvcEvent))
#6 <dir>/vendor/zendframework/zendframework/library/Zend/EventManager/EventManager.php(208): Zend\EventManager\EventManager->triggerListeners('bootstrap', Object(Zend\Mvc\MvcEvent), Array)
#7 <dir>/vendor/zendframework/zendframework/library/Zend/Mvc/Application.php(146): Zend\EventManager\EventManager->trigger('bootstrap', Object(Zend\Mvc\MvcEvent))
#8 <dir>/vendor/zendframework/zendframework/library/Zend/Mvc/Application.php(243): Zend\Mvc\Application->bootstrap()
#9 <dir>/public/index.php(23): Zend\Mvc\Application::init(Array)
#10 {main}
```
 
The default logfile is data/log/error.log

### EntityLogger
With this logger you can save database operations generated by your entities.

ATTENTION: This logger depends on [DoctrineORMModule](http://github.com/doctrine/DoctrineORMModule). 
Since its usage is optional, i did not put this requirement inside the composer.json

To enable this logger, register inside your doctrine's config (e.g. config/autoload/global.php)
```php
namespace App;
return array(
        // Doctrine config
        'doctrine' => array(
                'driver' => array(
                        __NAMESPACE__ . '_driver' => array(
                                'class' => 'Doctrine\ORM\Mapping\Driver\AnnotationDriver',
                                'cache' => 'array',
                                'paths' => array(
                                        __DIR__ . '/../src/' . __NAMESPACE__ . '/Entity'
                                )
                        ),
                        'orm_default' => array(
                                'drivers' => array(
                                        __NAMESPACE__ . '\Entity' => __NAMESPACE__ . '_driver'
                                )
                        )
                ),
                'eventmanager' => array(
                        'orm_default' => array(
                                'subscribers' => array(
                                        'LosLog\Log\EntityLogger'
                                )
                        )
                )
        )
);
```

will generate: 
```
2012-10-29T19:30:46-02:00 DEBUG (7): Inserting entity Application\Entity\Client. Fields: {"nome":[null,"ClientName"],"created_on":[null,{"date":"2012-10-29 19:30:46","timezone_type":3,"timezone":"America\/Sao_Paulo"}]}
2012-10-29T19:32:23-02:00 DEBUG (7): Updating entity Application\Entity\Client with id 3. Fields: {"nome":["ClientName","ClientName2"]}
2012-10-29T19:36:53-02:00 DEBUG (7): Deleting entity Application\Entity\Client with id 3.
```

The default logfile is data/log/entity.log

### SqlLogger
With this logger you can save all Doctrine database operations within your application.

ATTENTION: This logger depends on [DoctrineModule](http://github.com/doctrine/DoctrineModule). 
Since its usage is optional, i did not put this requirement inside the composer.json

Edit the config/autoload/loslog.global.php file to enable this logger.

The default logfile is data/log/sql.log

### StaticLogger
This logger is usually used to log development or debug messages. Just call it statically anywhere in your code.

```php
LosLog\Log\StaticLogger::save("Test message");
LosLog\Log\StaticLogger::save("Test message 2", 'test.log');
```
will generate
```
2012-10-29T19:32:30-02:00 DEBUG (6): Test message
```

Optionally, you can get it through Service Locator

```php
$logger = $sm->get('LosLog\Log\StaticLogger');
$logger->debug("Test message");
```
The default logfile is data/log/static.log
